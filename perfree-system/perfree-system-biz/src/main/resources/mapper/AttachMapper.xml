<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.perfree.mapper.AttachMapper">

    <select id="getTypeCount" resultType="com.perfree.controller.auth.adminHome.vo.HomeStatisticRespVO">
        SELECT
            SUM(CASE WHEN type = 'img' THEN num ELSE 0 END) AS attachImageTotal,
            SUM(CASE WHEN type = 'video' THEN num ELSE 0 END) AS attachVideoTotal,
            SUM(CASE WHEN type = 'audio' THEN num ELSE 0 END) AS attachAudioTotal,
            SUM(CASE WHEN type = 'other' THEN num ELSE 0 END) AS attachOtherTotal,
            SUM(num) AS attachTotal
        FROM (
                 SELECT count(1) as num , type FROM p_attach  GROUP BY type
             ) as subquery
    </select>
</mapper>
